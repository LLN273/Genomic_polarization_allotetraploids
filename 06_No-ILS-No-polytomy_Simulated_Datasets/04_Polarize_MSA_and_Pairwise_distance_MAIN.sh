#!/bin/bash
#
#SBATCH -J polartest
#SBATCH -p core 
#SBATCH -n 1
#SBATCH -t 24:00:00
#SBATCH -A snic2021-22-727
#SBATCH -M snowy
#SBATCH --mail-user luis.leal@ebc.uu.se
#SBATCH --mail-type=FAIL
ulimit -c unlimited
set -eo pipefail


## For each MSA and set of parental species, polarize polyploid based on all possible reference sequences.
## Re-run for all possible parental species pairs.
## For each run, compute pairwise distance between each sequence in MSA and the polarized polyploid




# load modules
module load bioinfo-tools
module load python3/3.8.7






#### paths and folder names

# remember initial path
SRCDIR_INI=$(pwd)      


# output folder (root)
AA=/crex1/proj/snic2020-6-184/private/Luis/P10_SIMULATED_FASTA_PHYLOGENY/20_No-ILS-No-polytomy_Simulated_Dataset

# Input/output subfolder (different simulation conditions)
INfolder=X_NoILS_16t_CLEAN

# Input file
MSA_IN=data_0001_TRUE.fasta

# Number of replicates
REP=100



## parental species

declare -A PARENTAL_SPECIES

PARENTAL_SPECIES[1,1]="1"
PARENTAL_SPECIES[1,2]="1"
PARENTAL_SPECIES[1,3]="1"
PARENTAL_SPECIES[1,4]="1"
PARENTAL_SPECIES[1,5]="1"
PARENTAL_SPECIES[1,6]="1"
PARENTAL_SPECIES[1,7]="1"
PARENTAL_SPECIES[1,8]="1"
PARENTAL_SPECIES[1,9]="1"
PARENTAL_SPECIES[1,10]="1"
PARENTAL_SPECIES[1,11]="1"
PARENTAL_SPECIES[1,12]="1"
PARENTAL_SPECIES[1,13]="1"
PARENTAL_SPECIES[1,14]="1"
PARENTAL_SPECIES[1,15]="1"

PARENTAL_SPECIES[1,16]="2"
PARENTAL_SPECIES[1,17]="2"
PARENTAL_SPECIES[1,18]="2"
PARENTAL_SPECIES[1,19]="2"
PARENTAL_SPECIES[1,20]="2"
PARENTAL_SPECIES[1,21]="2"
PARENTAL_SPECIES[1,22]="2"
PARENTAL_SPECIES[1,23]="2"
PARENTAL_SPECIES[1,24]="2"
PARENTAL_SPECIES[1,25]="2"
PARENTAL_SPECIES[1,26]="2"
PARENTAL_SPECIES[1,27]="2"
PARENTAL_SPECIES[1,28]="2"
PARENTAL_SPECIES[1,29]="2"

PARENTAL_SPECIES[1,30]="3"
PARENTAL_SPECIES[1,31]="3"
PARENTAL_SPECIES[1,32]="3"
PARENTAL_SPECIES[1,33]="3"
PARENTAL_SPECIES[1,34]="3"
PARENTAL_SPECIES[1,35]="3"
PARENTAL_SPECIES[1,36]="3"
PARENTAL_SPECIES[1,37]="3"
PARENTAL_SPECIES[1,38]="3"
PARENTAL_SPECIES[1,39]="3"
PARENTAL_SPECIES[1,40]="3"
PARENTAL_SPECIES[1,41]="3"
PARENTAL_SPECIES[1,42]="3"

PARENTAL_SPECIES[1,43]="4"
PARENTAL_SPECIES[1,44]="4"
PARENTAL_SPECIES[1,45]="4"
PARENTAL_SPECIES[1,46]="4"
PARENTAL_SPECIES[1,47]="4"
PARENTAL_SPECIES[1,48]="4"
PARENTAL_SPECIES[1,49]="4"
PARENTAL_SPECIES[1,50]="4"
PARENTAL_SPECIES[1,51]="4"
PARENTAL_SPECIES[1,52]="4"
PARENTAL_SPECIES[1,53]="4"
PARENTAL_SPECIES[1,54]="4"

PARENTAL_SPECIES[1,55]="5"
PARENTAL_SPECIES[1,56]="5"
PARENTAL_SPECIES[1,57]="5"
PARENTAL_SPECIES[1,58]="5"
PARENTAL_SPECIES[1,59]="5"
PARENTAL_SPECIES[1,60]="5"
PARENTAL_SPECIES[1,61]="5"
PARENTAL_SPECIES[1,62]="5"
PARENTAL_SPECIES[1,63]="5"
PARENTAL_SPECIES[1,64]="5"
PARENTAL_SPECIES[1,65]="5"

PARENTAL_SPECIES[1,66]="6"
PARENTAL_SPECIES[1,67]="6"
PARENTAL_SPECIES[1,68]="6"
PARENTAL_SPECIES[1,69]="6"
PARENTAL_SPECIES[1,70]="6"
PARENTAL_SPECIES[1,71]="6"
PARENTAL_SPECIES[1,72]="6"
PARENTAL_SPECIES[1,73]="6"
PARENTAL_SPECIES[1,74]="6"
PARENTAL_SPECIES[1,75]="6"

PARENTAL_SPECIES[1,76]="7"
PARENTAL_SPECIES[1,77]="7"
PARENTAL_SPECIES[1,78]="7"
PARENTAL_SPECIES[1,79]="7"
PARENTAL_SPECIES[1,80]="7"
PARENTAL_SPECIES[1,81]="7"
PARENTAL_SPECIES[1,82]="7"
PARENTAL_SPECIES[1,83]="7"
PARENTAL_SPECIES[1,84]="7"

PARENTAL_SPECIES[1,85]="8"
PARENTAL_SPECIES[1,86]="8"
PARENTAL_SPECIES[1,87]="8"
PARENTAL_SPECIES[1,88]="8"
PARENTAL_SPECIES[1,89]="8"
PARENTAL_SPECIES[1,90]="8"
PARENTAL_SPECIES[1,91]="8"
PARENTAL_SPECIES[1,92]="8"

PARENTAL_SPECIES[1,93]="9"
PARENTAL_SPECIES[1,94]="9"
PARENTAL_SPECIES[1,95]="9"
PARENTAL_SPECIES[1,96]="9"
PARENTAL_SPECIES[1,97]="9"
PARENTAL_SPECIES[1,98]="9"
PARENTAL_SPECIES[1,99]="9"

PARENTAL_SPECIES[1,100]="10"
PARENTAL_SPECIES[1,101]="10"
PARENTAL_SPECIES[1,102]="10"
PARENTAL_SPECIES[1,103]="10"
PARENTAL_SPECIES[1,104]="10"
PARENTAL_SPECIES[1,105]="10"

PARENTAL_SPECIES[1,106]="11"
PARENTAL_SPECIES[1,107]="11"
PARENTAL_SPECIES[1,108]="11"
PARENTAL_SPECIES[1,109]="11"
PARENTAL_SPECIES[1,110]="11"

PARENTAL_SPECIES[1,111]="12"
PARENTAL_SPECIES[1,112]="12"
PARENTAL_SPECIES[1,113]="12"
PARENTAL_SPECIES[1,114]="12"

PARENTAL_SPECIES[1,115]="13"
PARENTAL_SPECIES[1,116]="13"
PARENTAL_SPECIES[1,117]="13"

PARENTAL_SPECIES[1,118]="14"
PARENTAL_SPECIES[1,119]="14"

PARENTAL_SPECIES[1,120]="15"






PARENTAL_SPECIES[2,1]="2"
PARENTAL_SPECIES[2,2]="3"
PARENTAL_SPECIES[2,3]="4"
PARENTAL_SPECIES[2,4]="5"
PARENTAL_SPECIES[2,5]="6"
PARENTAL_SPECIES[2,6]="7"
PARENTAL_SPECIES[2,7]="8"
PARENTAL_SPECIES[2,8]="9"
PARENTAL_SPECIES[2,9]="10"
PARENTAL_SPECIES[2,10]="11"
PARENTAL_SPECIES[2,11]="12"
PARENTAL_SPECIES[2,12]="13"
PARENTAL_SPECIES[2,13]="14"
PARENTAL_SPECIES[2,14]="15"
PARENTAL_SPECIES[2,15]="16"

PARENTAL_SPECIES[2,16]="3"
PARENTAL_SPECIES[2,17]="4"
PARENTAL_SPECIES[2,18]="5"
PARENTAL_SPECIES[2,19]="6"
PARENTAL_SPECIES[2,20]="7"
PARENTAL_SPECIES[2,21]="8"
PARENTAL_SPECIES[2,22]="9"
PARENTAL_SPECIES[2,23]="10"
PARENTAL_SPECIES[2,24]="11"
PARENTAL_SPECIES[2,25]="12"
PARENTAL_SPECIES[2,26]="13"
PARENTAL_SPECIES[2,27]="14"
PARENTAL_SPECIES[2,28]="15"
PARENTAL_SPECIES[2,29]="16"

PARENTAL_SPECIES[2,30]="4"
PARENTAL_SPECIES[2,31]="5"
PARENTAL_SPECIES[2,32]="6"
PARENTAL_SPECIES[2,33]="7"
PARENTAL_SPECIES[2,34]="8"
PARENTAL_SPECIES[2,35]="9"
PARENTAL_SPECIES[2,36]="10"
PARENTAL_SPECIES[2,37]="11"
PARENTAL_SPECIES[2,38]="12"
PARENTAL_SPECIES[2,39]="13"
PARENTAL_SPECIES[2,40]="14"
PARENTAL_SPECIES[2,41]="15"
PARENTAL_SPECIES[2,42]="16"

PARENTAL_SPECIES[2,43]="5"
PARENTAL_SPECIES[2,44]="6"
PARENTAL_SPECIES[2,45]="7"
PARENTAL_SPECIES[2,46]="8"
PARENTAL_SPECIES[2,47]="9"
PARENTAL_SPECIES[2,48]="10"
PARENTAL_SPECIES[2,49]="11"
PARENTAL_SPECIES[2,50]="12"
PARENTAL_SPECIES[2,51]="13"
PARENTAL_SPECIES[2,52]="14"
PARENTAL_SPECIES[2,53]="15"
PARENTAL_SPECIES[2,54]="16"

PARENTAL_SPECIES[2,55]="6"
PARENTAL_SPECIES[2,56]="7"
PARENTAL_SPECIES[2,57]="8"
PARENTAL_SPECIES[2,58]="9"
PARENTAL_SPECIES[2,59]="10"
PARENTAL_SPECIES[2,60]="11"
PARENTAL_SPECIES[2,61]="12"
PARENTAL_SPECIES[2,62]="13"
PARENTAL_SPECIES[2,63]="14"
PARENTAL_SPECIES[2,64]="15"
PARENTAL_SPECIES[2,65]="16"

PARENTAL_SPECIES[2,66]="7"
PARENTAL_SPECIES[2,67]="8"
PARENTAL_SPECIES[2,68]="9"
PARENTAL_SPECIES[2,69]="10"
PARENTAL_SPECIES[2,70]="11"
PARENTAL_SPECIES[2,71]="12"
PARENTAL_SPECIES[2,72]="13"
PARENTAL_SPECIES[2,73]="14"
PARENTAL_SPECIES[2,74]="15"
PARENTAL_SPECIES[2,75]="16"

PARENTAL_SPECIES[2,76]="8"
PARENTAL_SPECIES[2,77]="9"
PARENTAL_SPECIES[2,78]="10"
PARENTAL_SPECIES[2,79]="11"
PARENTAL_SPECIES[2,80]="12"
PARENTAL_SPECIES[2,81]="13"
PARENTAL_SPECIES[2,82]="14"
PARENTAL_SPECIES[2,83]="15"
PARENTAL_SPECIES[2,84]="16"

PARENTAL_SPECIES[2,85]="9"
PARENTAL_SPECIES[2,86]="10"
PARENTAL_SPECIES[2,87]="11"
PARENTAL_SPECIES[2,88]="12"
PARENTAL_SPECIES[2,89]="13"
PARENTAL_SPECIES[2,90]="14"
PARENTAL_SPECIES[2,91]="15"
PARENTAL_SPECIES[2,92]="16"

PARENTAL_SPECIES[2,93]="10"
PARENTAL_SPECIES[2,94]="11"
PARENTAL_SPECIES[2,95]="12"
PARENTAL_SPECIES[2,96]="13"
PARENTAL_SPECIES[2,97]="14"
PARENTAL_SPECIES[2,98]="15"
PARENTAL_SPECIES[2,99]="16"

PARENTAL_SPECIES[2,100]="11"
PARENTAL_SPECIES[2,101]="12"
PARENTAL_SPECIES[2,102]="13"
PARENTAL_SPECIES[2,103]="14"
PARENTAL_SPECIES[2,104]="15"
PARENTAL_SPECIES[2,105]="16"

PARENTAL_SPECIES[2,106]="12"
PARENTAL_SPECIES[2,107]="13"
PARENTAL_SPECIES[2,108]="14"
PARENTAL_SPECIES[2,109]="15"
PARENTAL_SPECIES[2,110]="16"

PARENTAL_SPECIES[2,111]="13"
PARENTAL_SPECIES[2,112]="14"
PARENTAL_SPECIES[2,113]="15"
PARENTAL_SPECIES[2,114]="16"

PARENTAL_SPECIES[2,115]="14"
PARENTAL_SPECIES[2,116]="15"
PARENTAL_SPECIES[2,117]="16"

PARENTAL_SPECIES[2,118]="15"
PARENTAL_SPECIES[2,119]="16"

PARENTAL_SPECIES[2,120]="16"



#### REFERENCE SEQUENCE

REF[1]="1"
REF[2]="2"
REF[3]="3"
REF[4]="4"
REF[5]="5"
REF[6]="6"
REF[7]="7"
REF[8]="8"
REF[9]="9"
REF[10]="10"
REF[11]="11"
REF[12]="12"
REF[13]="13"
REF[14]="14"
REF[15]="15"
REF[16]="16"
REF[17]="0"



for r_aux in $( eval echo {001..100} ); do		# replicates; must include leading zeros (REPLICATE_001, REPLICATE_002, etc)

   GO_AA=$AA/$INfolder/$r_aux
   GO_RR=$GO_AA
   cd $GO_RR

   rsync -ah $SRCDIR_INI/03s_Pairwise_distance_MSA.py .

   #clean fasta
   cat $GO_AA/$MSA_IN | tr -d "[:blank:]" | grep -v '^$' > $GO_RR/data_0001_TRUE_CLEAN.fasta

   for k in `seq 1 1 120`; do 			# PARENTAL SPECIES
      for j in `seq 1 1 17`; do 		           # ref sequence
 
         PAR1=${PARENTAL_SPECIES[1,$k]}
         PAR2=${PARENTAL_SPECIES[2,$k]}
         REF_SEQ=${REF[$j]}
 
         if [ ${REF_SEQ} != ${PAR1} ] && [ ${REF_SEQ} != ${PAR2} ]; then


            MSA_AUX=data_0001_TRUE_CLEAN.fasta
            MSA_GO=${MSA_AUX%.fasta}_PAR1-${PAR1}_PAR2-${PAR2}_REF-${REF_SEQ}.fa
            cp $MSA_AUX $MSA_GO

            echo $r_aux $PAR1 $PAR2 $REF_SEQ

            
            # find 
            python3 ./04s_Polarize_MSA_and_Pairwise_distance.py $MSA_GO $REF_SEQ $PAR1 $PAR2

            cat ${MSA_GO%.fa}.stats | tail -n +2 | sort -h > ${MSA_GO%.fa}2.stats
            mv ${MSA_GO%.fa}2.stats ${MSA_GO%.fa}.stats
            rm -f $MSA_GO

         fi

      done
   done
done



